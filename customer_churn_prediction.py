# -*- coding: utf-8 -*-
"""Customer_Churn_Prediction.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1kLcnXlygFe8ZQ9DyZlxFBNAcD7Qjx_o0

#Business Context

AlphaCom, a leading telecommunications provider, has recently experienced a concerning rise in customer churn despite offering competitive services and a wide product portfolio. This increase is directly impacting revenue and undermining brand reputation in an intensely competitive market. Traditional retention strategies have proven inadequate because customer churn is influenced by a complex mix of factors, including service usage, billing preferences, contract types, and demographics. Without clear insights into these patterns, the company is left reacting to churn instead of preventing it.

#Objective:

As a data scientist at AlphaCom, you are tasked with developing a predictive model to identify customers at high risk of churn and uncover the key factors driving their decisions. Solving this problem will enable the company to proactively design targeted retention strategies, reduce churn-related losses, and improve customer lifetime value, ultimately safeguarding revenue and strengthening AlphaCom’s competitive position.

#Data Description:

The data contains different attributes related to churn. The detailed data dictionary is given below:

**Gender:** The customer’s gender (e.g., Male or Female). This demographic feature may correlate with customer behavior.

**Age Range:** Indicates the customer’s age bracket (e.g., 18–25, 26–35, etc.), offering demographic insights that can impact churn analysis.

**SeniorCitizen:** A binary indicator (if included) that identifies whether the customer is a senior citizen (commonly 1 for senior, 0 for non-senior). Senior status can influence service preferences and retention strategies.
Partner: Indicates whether the customer has a partner. This factor can affect customer loyalty and service usage patterns.

**Dependents:** Specifies whether the customer has dependents. This information can provide context on the customer’s household and influence their service needs.

**Tenure:** The number of months the customer has been with the company. Longer tenure may indicate higher loyalty, while shorter tenure could be a churn risk indicator.

**PhoneService:** Denotes whether the customer subscribes to telephone services. This binary feature (Yes/No) helps understand service adoption.


**MultipleLines:** Indicates if the customer has multiple phone lines. This feature can provide insight into customer behavior and service complexity.

**InternetService:** Describes the type of internet service the customer uses (e.g., DSL, Fiber optic, or None). The type of internet service can be a critical factor in churn analysis.

**OnlineSecurity: **Shows whether the customer subscribes to online security services. This value (Yes/No) may influence customer satisfaction and retention.

**OnlineBackup:** Indicates if the customer has an online backup service. Similar to online security, this can be a part of the overall service bundle affecting churn
.
**DeviceProtection:** Specifies whether the customer is enrolled in a device protection plan, providing an added layer of service value.

**TechSupport:** Denotes if the customer subscribes to technical support services. Access to tech support can improve customer experience and reduce churn.

**StreamingTV:** Indicates whether the customer subscribes to a streaming TV service. Media consumption patterns can be a differentiator in customer preferences.

**StreamingMovies:** Specifies if the customer subscribes to a streaming movies service. This, combined with other services, can highlight trends in customer behavior.

**Contract**: Describes the type of contract the customer holds (e.g., month-to-month, one-year, or two-year). Contract type is a strong indicator of churn risk—shorter contracts are often associated with higher churn.

**PaperlessBilling:** Indicates whether the customer is enrolled in paperless billing. This operational feature can sometimes correlate with customer engagement levels.

**PaymentMethod:** Details the payment method used by the customer (e.g., electronic check, mailed check, bank transfer, or credit card). Payment methods can affect both churn and overall customer satisfaction.

**MonthlyCharges:** The monthly amount in $ USD charged to the customer. Higher charges might increase the likelihood of churn if customers perceive the cost as too high for the value provided.

**TotalCharges:** The cumulative amount in $ USD charged over the customer’s tenure. This helps in understanding the long-term value of each customer and can be a predictor of churn.

**Churn:** The target variable indicating whether the customer has left (typically denoted as “Yes” or “No”). This is the primary outcome you aim to predict with your machine learning model.

#Import Required Library
"""

import numpy as np
import pandas as pd

import matplotlib.pyplot as plt
import seaborn as sns

from google.colab import drive
drive.mount('/content/drive')

"""#Loading the data"""

df =pd.read_csv('/content/drive/MyDrive/capston1/customer_churn.csv')

"""#Copy Data From Another veriable"""

data = df.copy()

data.head()

data.tail()

"""#Data Cleaning"""

data.nunique()

"""#Checking the shape of the dataset"""

data.shape

"""in this data set there is 20 columns and 12055 rows

**Checking null values**
"""

data.isnull().sum()

"""There is 604 empty values for teure . let's check and fix it .

**Fix Null values**
"""

data['tenure'].isnull().sum()

"""There is total 604 nan value is tenure .Replace NaN to 0."""

data['tenure'] = data['tenure'].fillna(0)

"""Checking negtive value in tenue"""

(data['tenure'] < 0).sum()

"""There is totla 127 values show -ve number and according to description -ve number is not valid"""

data.loc[data['tenure'] < 0, 'tenure'].unique()

"""All -ve value is look like  addded by mistake so replace it with its matching value like - 1,-2,-3 to 0"""

data.loc[df['tenure'] < 0, 'tenure'] = 0

(data['tenure'] < 0).sum()

"""There is no -ve value and not NaN in tenure ."""

data.isna().sum()

"""There is no Any NAN value in data set

**Checking duplicate value**
"""

data.duplicated().sum()

"""There is 2 duplicate data in the dat set  lets look that"""

print("Duplicated rows:")
print(data[data.duplicated(keep=False)])

data.drop_duplicates(inplace=True)
print(f"\nNumber of rows after removing duplicates: {data.shape[0]}")

data.info()

data.describe().T

"""we have total 20 columns and in this there are 1 is type int 3 is float type and 16 is objective type"""

data['Churn'].unique()

data['Churn'] = data['Churn'].str.strip().str.capitalize()
data['Churn'].unique()

"""#Data Preprocessing

Let's check the count of each unique category in each of the categorical variables.
"""

# Making a list of all catrgorical variables
cat_col = list(data.select_dtypes("object").columns)

# Printing number of count of each unique value in each column
for column in cat_col:
    print(data[column].value_counts())
    print("-" * 50)

"""by see  each unique category in each of the categorical variables we  found 2 issue

1) TotalCharges show £nan this simbole instent of $
2) PaymentMethod show diffrent category of most same type due to spelling  change so make it correct

Total Charges currency signe fix
"""

data['TotalCharges'].head(10)

"""Remove currecy sign of both total charg and monthlychage"""

data['TotalCharges'] = data['TotalCharges'].astype(str)

data['TotalCharges'] = data['TotalCharges'].str.replace(r'[$£]', '', regex=True)

data['MonthlyCharges'] = data['MonthlyCharges'].astype(str)

data['MonthlyCharges'] = data['MonthlyCharges'].str.replace(r'[$£]', '', regex=True)

"""convert Total charg and monthly charge data type into float  data type to float"""

data['TotalCharges'] = pd.to_numeric(data['TotalCharges'], errors='coerce')
data['MonthlyCharges'] = pd.to_numeric(data['MonthlyCharges'], errors='coerce')

data.isnull().sum()

"""So now there is 301 null value in MonthlyCharge and 1205 null value in total charge"""

data['MonthlyCharges'] = data['MonthlyCharges'].fillna(
    data['MonthlyCharges'].median()
)

# Step 2: Fill remaining TotalCharges
mask = data['TotalCharges'].isna()

data.loc[mask, 'TotalCharges'] = (
    data.loc[mask, 'tenure'] * data.loc[mask, 'MonthlyCharges']
)

data.isnull().sum()

data.head()

"""Payment menthod correction"""

data['PaymentMethod'] = (
    data['PaymentMethod']
    .str.strip()        # remove leading/trailing spaces
    .str.lower()        # convert to lowercase
)

data['PaymentMethod'].value_counts()

"""#Exploratory Data Analysis (EDA)

Univariate Analysis
"""

# function to plot a boxplot and a histogram along the same scale.


def histogram_boxplot(data, feature, figsize=(12, 7), kde=False, bins=None):
    """
    Boxplot and histogram combined

    data: dataframe
    feature: dataframe column
    figsize: size of figure (default (12,7))
    kde: whether to the show density curve (default False)
    bins: number of bins for histogram (default None)
    """
    f2, (ax_box2, ax_hist2) = plt.subplots(
        nrows=2,  # Number of rows of the subplot grid= 2
        sharex=True,  # x-axis will be shared among all subplots
        gridspec_kw={"height_ratios": (0.25, 0.75)},
        figsize=figsize,
    )  # creating the 2 subplots
    sns.boxplot(
        data=data, x=feature, ax=ax_box2, showmeans=True, color="violet"
    )  # boxplot will be created and a star will indicate the mean value of the column
    sns.histplot(
        data=data, x=feature, kde=kde, ax=ax_hist2, bins=bins, palette="winter"
    ) if bins else sns.histplot(
        data=data, x=feature, kde=kde, ax=ax_hist2
    )  # For histogram
    ax_hist2.axvline(
        data[feature].mean(), color="green", linestyle="--"
    )  # Add mean to the histogram
    ax_hist2.axvline(
        data[feature].median(), color="black", linestyle="-"
    )  # Add median to the histogram

histogram_boxplot(data, "tenure")

"""The boxplot shows no extreme outliers

The tenure distribution is right-skewed, with a large concentration of customers having low tenure .

The median tenure is lower than the mean, indicating that many customers leave early, while a smaller group stays for a long time up to 70 months.

"""

histogram_boxplot(data, "MonthlyCharges")

"""Boxplot shows there is no outlire

Monthly charges show a bimodal distribution, with one cluster around lower charges 10-30 and another around higher charges 100-120.

The median lies slightly above the lower cluster, while the mean is higher due to customers paying premium prices.


"""

histogram_boxplot(data, "TotalCharges")

"""TotalCharges is heavily right-skewed, with most customers having low cumulative charges.

A long tail exists for customers with high TotalCharges, representing long tenure and high value customers.

The median is significantly lower than the mean, reflecting that most customers do not stay long enough to accumulate high total spending.
"""

# function to create labeled barplots


def labeled_barplot(data, feature, perc=False, n=None):
    """
    Barplot with percentage at the top

    data: dataframe
    feature: dataframe column
    perc: whether to display percentages instead of count (default is False)
    n: displays the top n category levels (default is None, i.e., display all levels)
    """

    total = len(data[feature])  # length of the column
    count = data[feature].nunique()
    if n is None:
        plt.figure(figsize=(count + 1, 5))
    else:
        plt.figure(figsize=(n + 1, 5))

    plt.xticks(rotation=90, fontsize=15)
    ax = sns.countplot(
        data=data,
        x=feature,
        palette="Paired",
        hue=feature,
        order=data[feature].value_counts().index[:n].sort_values(),
    )

    for p in ax.patches:
        if perc == True:
            label = "{:.1f}%".format(
                100 * p.get_height() / total
            )  # percentage of each class of the category
        else:
            label = p.get_height()  # count of each level of the category

        x = p.get_x() + p.get_width() / 2  # width of the plot
        y = p.get_height()  # height of the plot

        ax.annotate(
            label,
            (x, y),
            ha="center",
            va="center",
            size=12,
            xytext=(0, 5),
            textcoords="offset points",
        )  # annotate the percentage

    plt.show()  # show the plot

labeled_barplot(data, "gender", perc=True);

"""Male ratio is slightly high as compair to female"""

labeled_barplot(data, "PaymentMethod", perc=True);

"""around 34 % people choose elsectronic check for pay bills"""

labeled_barplot(data, "PaperlessBilling", perc=True);

"""There is no huge diffrence between paperlessbilling"""

labeled_barplot(data, "Contract", perc=True);

"""Arround 54% of people take month to month contract"""

labeled_barplot(data, "OnlineBackup", perc=True);

"""Arround 50 '5 of people not take nay backup and 23 % of people not take any internet service"""

labeled_barplot(data, "Dependents", perc=True);

"""73% people and no depends"""

labeled_barplot(data, "PhoneService", perc=True);

"""89% of people take phoneservice"""

labeled_barplot(data, "InternetService", perc=True);

"""most of the internet service is used by fiberoptic"""

labeled_barplot(data, "StreamingMovies", perc=True);

labeled_barplot(data, "StreamingTV", perc=True);

labeled_barplot(data, "TechSupport", perc=True);

"""most of the people no take tech support ,no tv streming and no streaming movies

#Bivariate Analysis
"""

cols_list = data.select_dtypes(include=np.number).columns.tolist()

plt.figure(figsize=(10, 5))
sns.heatmap(
    data[cols_list].corr(), annot=True, vmin=-1, vmax=1, fmt=".2f", cmap="Spectral"
)
plt.show()

"""**Observations**

Tenure and TotalChare are highly correlated

MonthlyChare and Total charege are also correlated with each other.

There is not much correlation among the rest of the variables.
"""